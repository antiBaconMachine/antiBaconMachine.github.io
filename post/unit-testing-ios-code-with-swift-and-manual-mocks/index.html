<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Unit testing iOS code with Swift and manual stubs</title>
  <meta property="og:title" content="Unit testing iOS code with Swift and manual stubs" />
  <meta name="twitter:title" content="Unit testing iOS code with Swift and manual stubs" />
  <meta name="description" content="In general I find unit testing on the iOS platform to be a pain. Xcode&rsquo;s built in test library, XCTest, is very basic and whilst I&rsquo;m reasonably inexperienced with iOS development, it does seem the community as a whole doesn&rsquo;t really rate unit testing. Automated front end integration testing seems to have a much higher mind share.
Now I&rsquo;m not against this approach at all. As with any front end tech, there are limits to what isolated unit testing can achieve.">
  <meta property="og:description" content="In general I find unit testing on the iOS platform to be a pain. Xcode&rsquo;s built in test library, XCTest, is very basic and whilst I&rsquo;m reasonably inexperienced with iOS development, it does seem the community as a whole doesn&rsquo;t really rate unit testing. Automated front end integration testing seems to have a much higher mind share.
Now I&rsquo;m not against this approach at all. As with any front end tech, there are limits to what isolated unit testing can achieve.">
  <meta name="twitter:description" content="In general I find unit testing on the iOS platform to be a pain. Xcode&rsquo;s built in test library, XCTest, is very basic and whilst I&rsquo;m reasonably inexperienced with iOS development, it does â€¦">
  <meta name="author" content="Ollie Edwards"/>
  <link href='https://antibaconmachine.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://antibaconmachine.github.io/img/avatar-icon.png" />
  <meta name="twitter:image" content="https://antibaconmachine.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://antibaconmachine.github.io/post/unit-testing-ios-code-with-swift-and-manual-mocks/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="This is not an ambulance" />

  <meta name="generator" content="Hugo 0.22" />
  <link rel="canonical" href="https://antibaconmachine.github.io/post/unit-testing-ios-code-with-swift-and-manual-mocks/" />
  <link rel="alternate" href="https://antibaconmachine.github.io/index.xml" type="application/rss+xml" title="This is not an ambulance">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://antibaconmachine.github.io/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://antibaconmachine.github.io/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://antibaconmachine.github.io/css/highlight.min.css" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-101014744-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://antibaconmachine.github.io">This is not an ambulance</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="This is not an ambulance" href="https://antibaconmachine.github.io">
            <img class="avatar-img" src="https://antibaconmachine.github.io/img/avatar-icon.png" alt="This is not an ambulance" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Unit testing iOS code with Swift and manual stubs</h1>
                
                
                  <span class="post-meta">
  Posted on December 23, 2014
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>In general I find unit testing on the iOS platform to be a pain. Xcode&rsquo;s built in test library, XCTest, is very basic and whilst I&rsquo;m reasonably inexperienced with iOS development, it does seem the community as a whole doesn&rsquo;t really rate unit testing. Automated front end integration testing seems to have a much higher mind share.</p>

<p>Now I&rsquo;m not against this approach at all. As with any front end tech, there are limits to what isolated unit testing can achieve. An application is about more than the sum of its parts and that simply can&rsquo;t be expressed with unit tests. However, I still feel that a solid set of unit tests for model objects and even some controller logic is extremely beneficial.</p>

<p>A great unit test suite should be like readable documentation, and that&rsquo;s why I&rsquo;ve been writing my iOS tests in Swift, even though the app itself is written in Objective C. Whilst readability is a matter of opinion, I don&rsquo;t think you&rsquo;ll find many who rate Objective C higher in that respect. Certainly in our primarily JavaScript focused team, we find it much easier to scan.</p>

<p>Swift is still very new and as such there are a few areas lacking, one of which is metaprogramming support, which of course means automated mocking and stubbing for unit tests is currently impossible.</p>

<p>I&rsquo;d like to share my first attempt at a manual inline stubbing in Swift.</p>

<p>First we define a simple captor object to track function invocations:</p>

<pre><code class="language-language-swift">private class FunctionCall {
    let name:String
    let args:[Any]?
     
    init(name:String, args:[Any]?) {
        self.name = name
        self.args = args
    }
}    
</code></pre>

<p>We then override our target class with a few extra helpers. In this case I&rsquo;m stubbing a pebble watch model object.</p>

<pre><code class="language-language-swift"> private class MockPebbleDevice: PebbleDevice {
    //Track the calls made
    var calls:[FunctionCall] = []
        
    //We can manipulate the results of each function call as needed
    var responses:[String:AnyObject] = [
        &quot;isConnected&quot;:false
    ]

    //helper which logs each function and returns appropriate result
    func stub(functionName:String, args:[Any]?) -&gt; AnyObject? {
        calls.append(FunctionCall(name: functionName, args: args))
        return responses[functionName]
    }
        
    //stub functions follow here
    override func isConnected() -&gt; Bool {
        return stub(&quot;isConnected&quot;, args: nil) as Bool
    }
        
    //more stubs as required
    ...
        
}
</code></pre>

<p>We can then inject this model to our fixture, and control the results of each function call by manipulating the responses dictionary. Here&rsquo;s an extract from one of the tests using this structure:</p>

<pre><code class="language-language-swift">...
fixture.didReceiveWatchSecret(VALID_SECRET, withCallback: nil)
        
XCTAssertEqual(self.device.calls.count, 3, &quot;We have made 3 calls to the watch&quot;)
        
let nameCall = self.device.calls[0];
XCTAssertEqual(nameCall.name, &quot;name&quot;, &quot;First call was to get device name&quot;)
let connectedCall = self.device.calls[1];
XCTAssertEqual(connectedCall.name, &quot;isConnected&quot;, &quot;We checked connectivity as the 2nd call&quot;)
...
</code></pre>

<p>The process of setting up the mock object is very manual, but it got us where we needed to be for these test cases.</p>

<p>I&rsquo;d love to hear about your experiences tackling the problem of mocks and stubs in Swift. One of the exciting things about working with a new language is that no one yet knows the best answers to these problems and I&rsquo;m sure there are many other interesting approaches out there.</p>

      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://antibaconmachine.github.io/post/why-u-no-offline-meteor/" data-toggle="tooltip" data-placement="top" title="Why u no offline meteor?">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="https://antibaconmachine.github.io/post/roll-your-own-javascript-framework/" data-toggle="tooltip" data-placement="top" title="Roll your own JavaScript framework">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'thisisnotanambulance';
    var disqus_identifier = 'https:\/\/antibaconmachine.github.io\/post\/unit-testing-ios-code-with-swift-and-manual-mocks\/';
    var disqus_title = 'Unit testing iOS code with Swift and manual stubs';
    var disqus_url = 'https:\/\/antibaconmachine.github.io\/post\/unit-testing-ios-code-with-swift-and-manual-mocks\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:oliver.s.edwards@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/antiBaconMachine" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://antibaconmachine.github.io/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Ollie Edwards
          &nbsp;&bull;&nbsp;
          2016

          
            &nbsp;&bull;&nbsp;
            <a href="https://antibaconmachine.github.io">This is not an ambulance</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.22</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://antibaconmachine.github.io/js/main.js"></script>
<script src="https://antibaconmachine.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
<script src="/js/load-photoswipe.js"></script>



  </body>
</html>

